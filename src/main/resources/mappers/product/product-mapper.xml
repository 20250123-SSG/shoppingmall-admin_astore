<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.aplestore.dao.ProductMapper">
    <!-- 모델저장여부확인 및 model_id 반환-->
    <select id="selectModelIdIfExists" parameterType="string" resultType="java.lang.Integer">
        SELECT
            id
        FROM
            models
        WHERE
            model_name = #{modelName}
    </select>

    <!-- 기존에 저장되지 않은 상품에 대해 insert 해주기-->
    <insert id="insertModel" parameterType="ProductModelOptionDTO" useGeneratedKeys="true" keyProperty="id">
        insert INTO models(
             product_id
           , model_name
           , model_description
        )
        values(
             (Select id FROM products WHERE product_name = #{productName})
            , #{modelName}
            , #{modelDescription}
        )
    </insert>

    <select id="countExistsModel" parameterType="ProductModelOptionDTO">
        SELECT
            COUNT(*)
        FROM
            model_options
        WHERE model_id = (SELECT id FROM models WHERE model_name = #{modelName})
            AND color = #{color}
            AND ram = #{ram}
            AND size = #{size}
            AND optional_model_price = #{optionalModelPrice}

    </select>

    <!-- 상품등록 -->
    <insert id="insertProduct">
        INSERT INTO model_options
        (
          model_id
        , color
        , ram
        , size
        , optional_model_price
        , created_at
        , modified_at
        )
        VALUES
            (
            (SELECT id FROM models WHERE model_name = #{modelName})
            , #{color}
            , #{ram}
            , #{size}
            , #{optionalModelPrice}
            , NOW()
            , NOW()
            )
    </insert>

<!--    &lt;!&ndash; 상품수정 &ndash;&gt;-->
<!--    <update id="updateProduct">-->
<!--        UPDATE-->
<!--            model_options-->
<!--        SET-->
<!--            (-->
<!--                model_id = (SELECT id FROM models WHERE name = #{modelName}-->
<!--                    , color = #{color}-->
<!--                    , ram = #{ram}-->
<!--                    , size = #{size}-->
<!--                    , optional_model_price = #{optionalModelPrice}-->
<!--                    , modify_date = NOW()-->
<!--                    )-->
<!--    </update>-->

</mapper>





